# config/routes.rb
Rails.application.routes.draw do
  # Handle CORS preflight OPTIONS requests
  match '*path', via: :options, to: 'application#options_request'

  if Rails.env.development?
    mount LetterOpenerWeb::Engine, at: '/letter_opener'
  end


  namespace :api do
    namespace :v1, defaults: { format: :json } do
      get  'csrf',           to: 'auth/csrf#show'
      post 'signup',         to: 'auth/signup#create'

      devise_for :amigos,
        path: '',
        path_names: { sign_in: 'login', sign_out: 'logout', sign_up: 'signup' },
        controllers: {
          sessions:      'auth/sessions',
          registrations: 'auth/registrations',
          confirmations: 'auth/confirmations',
          passwords:     'auth/passwords',
          unlocks:       'auth/unlocks'
        }

      devise_scope :amigo do
        post 'refresh_token', to: 'auth/sessions#refresh'
        get  'verify_token',  to: 'auth/sessions#verify_token'
      end

      get 'me', to: 'amigos#me'

      resources :amigos, only: %i[index show create update destroy] do
        resource  :amigo_detail,    only: %i[show create update destroy]
        resources :amigo_locations, only: %i[index create show update destroy]
      end

      resources :events, except: %i[new edit] do
        resources :event_amigo_connectors, except: %i[new edit]
        resources :event_location_connectors, only: %i[index show create update destroy]
      end

      resources :event_locations, except: %i[new edit]
    end
  end
end
